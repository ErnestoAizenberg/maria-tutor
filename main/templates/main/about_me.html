{% extends 'main/base.html' %}

{% block title %}{% if page and page.title %}{{ page.title }}{% endif %}{% endblock %}

{% block meta_description %}{{ page.meta_description }}{% endblock %}

{% block meta_keywords %}{{ page.meta_keywords }}{% endblock %}

{% block og_type %}{{ page.og_type }}{% endblock %}
{% block og_site_name %}{{ page.og_site_name }}{% endblock %}
{% block og_title %}{{ page.og_title }}{% endblock %}
{% block og_description %}{{ page.og_description }}{% endblock %}
{% block og_url %}{{ request.get_absolute_uri }}{% endblock %}
{% block og_image %}{{ page.og_image }}{% endblock %}
{% block og_image_alt %}{{ page.og_image_alt }}{% endblock %}
{% block og_image_width %}{{ page.og_image_width }}{% endblock %}
{% block og_image_height %}{{ page.og_image_height }}{% endblock %}
{% block og_locale %}{{ page.og_locale }}{% endblock %}

{% block twitter_card %}{% if page and page.twitter_card %}{{ page.twitter_card }}{% endif %}{% endblock %}
{% block twitter_title %}{{ page.twitter_title }}{% endblock %}
{% block twitter_description %}{{ page.twitter_description }}{% endblock %}
{% block twitter_image %}{{ page.twitter_image }}{% endblock %}

{% block content %}
  <div class="container mx-auto px-4 py-12 max-w-6xl">
    <!-- Hero Section -->
    <section class="text-center mb-16">
      <h1 class="text-4xl font-bold mb-4">{{ page.hero_title }}</h1>
      <p class="text-xl text-secondary max-w-3xl mx-auto">
        {{ page.hero_sub_title }}
      </p>
    </section>

    <!-- Main Content -->
    <div class="flex flex-col lg:flex-row gap-12">
      <!-- Photo & Quick Facts -->
      <div class="lg:w-1/3">
        <div class="card p-6 sticky top-6">
          {% if teacher.avatar2 %}
          <img src="{{ teacher.avatar2.url }}"
               alt="{{ teacher.name }} - {{ teacher.status }}"
               class="rounded-full w-64 h-64 object-cover mx-auto mb-6 border-4 border-primary">
          {% endif %}

          <div class="space-y-4">
            {% if teacher.education %}
            <div>
              <h3 class="font-bold text-lg text-primary">Образование:</h3>
              <ul class="list-disc pl-5 space-y-2">
                {% for education in teacher.education.items %}
                  <li>
                    <span class="font-semibold">{{ education.degree }}</span>
                    <span class="block text-sm text-gray-600">{{ education.institution }}, специализация: {{ education.specialisation }}</span>
                  </li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
          {% if teacher.scientific_work %}
            <div>
              <h3 class="font-bold text-lg text-primary">Научная работа:</h3>
              <ul class="list-disc pl-5 space-y-1">
                {% for fact in teacher.scientific_work.facts %}
                  <li>{{ fact }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
          {% if teacher.tutoring %}
            <div>
              <h3 class="font-bold text-lg text-primary">Преподавание:</h3>
              <ul class="list-disc pl-5 space-y-1">
                {% for fact in teacher.tutoring.facts %}
                  <li>{{ fact }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}
          </div>
        </div>
      </div>

      <!-- Detailed Bio -->
      <div class="lg:w-2/3 space-y-8">
        <!-- Dynamic Sections -->
        {% for section in page.sections %}
          <section class="mb-12">
            {% if section.name %}
              <h2 class="text-3xl font-bold mb-6 text-primary border-b pb-2">{{ section.name }}</h2>
            {% endif %}

            {% for card in section.cards %}
              <div class="card rounded-lg shadow-sm p-6 mb-6" style="{% if card.featured %}background-color: rgba(76, 175, 80, 0.3);{% endif %}">
                {% if card.icon_name %}
                  <div class="text-primary text-2xl mr-4">
                    <i class="{{ card.icon_name }}" aria-hidden="true"></i>
                  </div>
                {% endif %}

                {% if card.name %}
                  <h3 class="text-xl font-bold mb-3 text-primary">{{ card.name }}</h3>
                {% endif %}

                {% if card.subtitle %}
                  <p class="mb-4">{{ card.subtitle }}</p>
                {% endif %}

                {% if card.content %}
                  <div class="prose max-w-none">
                    {{ card.content|safe }}
                  </div>
                {% endif %}

                {% if card.items %}
                  <ul class="list-disc pl-5 space-y-1 mt-2">
                    {% for item in card.items %}
                      <li>{{ item }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}

                {% if card.footer %}
                  <div class="mt-4 pt-3 border-t text-sm text-gray-600">
                    {{ card.footer }}
                  </div>
                {% endif %}
              </div>
            {% endfor %}
          </section>
        {% endfor %}

        {% if publications %}
        <!-- Publications -->
        <section>
          <h2 class="text-3xl font-bold mb-6 text-primary border-b pb-2">Научные публикации</h2>
          {% for publication in publications %}

          <div class="space-y-4">
            <div class="border-l-4 border-primary pl-4 py-2">
              <h3 class="font-bold">{{ publication.title }}</h3>
              <p class="text-sm text-text-secondary">{{ publication.get_authors_short }} {{ publication.journal }}, {{ publication.publication_date|date:"Y" }}</p>
              <a href="{{ publication.url }}" class="text-primary text-sm hover:underline">DOI: {{ publication.doi }}</a>
            </div>
          </div>

          {% endfor %}
          <div class="mt-6 text-center">
            <a href="/publications" class="btn btn-outline">Все публикации (5+)</a>
          </div>
        </section>
        {% endif %}
      </div>
    </div>

    {% if page.cta %}
    <!-- CTA Section -->
    <section class="mt-20 text-center bg-primary text-white p-12 rounded-2xl">
      <h2 class="text-3xl font-bold mb-4">{{ page.cta.heading }}</h2>
      <p class="text-xl mb-8 max-w-2xl mx-auto">
        {{ page.cta.text }}
      </p>
      <a href="{{ page.cta.url }}" class="btn bg-white text-primary px-8 py-3 text-lg font-bold hover:bg-gray-100">
        {{ page.cta.button_text }}
      </a>
    </section>
    {% endif %}
  </div>
{% endblock %}
